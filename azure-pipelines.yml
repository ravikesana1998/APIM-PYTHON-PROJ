trigger:
  branches:
    include: [main]

pool:
  name: 'self-hosted-pool'

variables:
  API_VERSION: 'v1'
  SWAGGER_URL: 'https://swagger-server-bcf2hegkbbdzb0e3.canadacentral-01.azurewebsites.net/swagger/v1/swagger.json'
  PYTHON_PATH: '/usr/bin/python3'
  SCRIPT_PATH: 'sync_full_apim.py'
  AZURE_SUBSCRIPTION_ID: '85b61d1d-92dd-4311-90eb-4f3e1263adca'
  AZURE_RESOURCE_GROUP: 'rg-23-6'
  AZURE_APIM_NAME: 'dotnetapi9'
  AZURE_APIM_API_ID: 'dotnetapi9'

stages:
- stage: SyncToAPIM
  displayName: ðŸš€ Sync Swagger to APIM
  jobs:
  - job: SyncJob
    steps:
    - script: |
        echo "ðŸšš Starting full sync process..."
        $(PYTHON_PATH) "$(Build.SourcesDirectory)/$(SCRIPT_PATH)"
      env:
        SWAGGER_URL: $(SWAGGER_URL)
        AZURE_SUBSCRIPTION_ID: $(AZURE_SUBSCRIPTION_ID)
        AZURE_RESOURCE_GROUP: $(AZURE_RESOURCE_GROUP)
        AZURE_APIM_NAME: $(AZURE_APIM_NAME)
        AZURE_APIM_API_ID: $(AZURE_APIM_API_ID)
      displayName: ðŸ”„ Sync Full Swagger to APIM
